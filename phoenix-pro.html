<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú¯Ù„Ø¯ÛŒØ§Ø± Ù¾Ø±Ùˆ - ØªØ­Ù„ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§ Ùˆ Ø§Ø±Ø²</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #141824;
            --bg-card: rgba(30, 35, 50, 0.9);
            --border-color: rgba(251, 191, 36, 0.2);
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --accent-gold: #fbbf24;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-blue: #3b82f6;
            --sidebar-width: 280px;
        }
        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: rgba(255, 255, 255, 0.95);
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.3s ease;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }
        body::before {
            content: '';
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(circle at 20% 30%, rgba(251,191,36,0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(245,158,11,0.06) 0%, transparent 50%);
            opacity: 1; pointer-events: none; z-index: 0;
        }
        body::after {
            content: '';
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 100px, rgba(251,191,36,0.01) 100px, rgba(251,191,36,0.01) 200px),
                repeating-linear-gradient(-45deg, transparent, transparent 100px, rgba(245,158,11,0.01) 100px, rgba(245,158,11,0.01) 200px);
            opacity: 0.5; pointer-events: none; z-index: 0;
        }
        [data-theme="light"] body::before { opacity: 0.3; }
        [data-theme="light"] body::after { opacity: 0.2; }

        /* ===== SIDEBAR ===== */
        .sidebar {
            position: fixed; right: 0; top: 0;
            width: var(--sidebar-width); height: 100vh;
            background: var(--bg-secondary);
            border-left: 2px solid var(--border-color);
            padding: 1.5rem; overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 1000;
            box-shadow: -4px 0 20px rgba(0,0,0,0.3);
        }
        .sidebar.hidden { transform: translateX(100%); }
        @media (max-width: 968px) {
            .sidebar { transform: translateX(100%); width: 100%; max-width: 320px; }
            .sidebar.show { transform: translateX(0); }
        }
        .logo { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px solid var(--border-color); }
        .logo-icon { font-size: 2.5rem; filter: drop-shadow(0 0 8px rgba(251,191,36,0.5)); }
        .logo-text { font-size: 1.5rem; font-weight: bold; background: linear-gradient(135deg, var(--accent-gold), #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .user-info { background: var(--bg-card); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1.5rem; border: 1px solid var(--border-color); }
        .user-email { font-size: 0.9rem; color: var(--accent-green); font-weight: 600; margin-bottom: 0.5rem; }
        .user-status { display: inline-block; background: linear-gradient(135deg, var(--accent-gold), #f59e0b); color: #000; padding: 0.3rem 0.75rem; border-radius: 1rem; font-size: 0.75rem; font-weight: bold; }
        .nav-item { padding: 0.9rem 1.2rem; margin-bottom: 0.6rem; border-radius: 0.75rem; cursor: pointer; display: flex; align-items: center; gap: 1rem; transition: all 0.3s; color: var(--text-secondary); border: 1px solid transparent; }
        .nav-item:hover { background: var(--bg-card); color: var(--text-primary); border-color: var(--border-color); transform: translateX(-4px); }
        .nav-item.active { background: linear-gradient(135deg, var(--accent-blue), #2563eb); color: white; font-weight: 600; box-shadow: 0 4px 12px rgba(59,130,246,0.4); }
        .nav-icon { font-size: 1.3rem; width: 1.8rem; }

        /* ===== MAIN ===== */
        .main-content { margin-right: var(--sidebar-width); padding: 2rem; min-height: 100vh; position: relative; z-index: 1; }
        @media (max-width: 968px) { .main-content { margin-right: 0; padding: 1rem; } }

        /* ===== TOPBAR ===== */
        .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding: 1.2rem 1.5rem; background: var(--bg-card); border-radius: 1rem; border: 1px solid var(--border-color); backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .hamburger { display: none; font-size: 1.8rem; cursor: pointer; padding: 0.5rem; color: var(--accent-gold); transition: transform 0.3s; }
        .hamburger:hover { transform: rotate(90deg); }
        @media (max-width: 968px) { .hamburger { display: block; } }
        .topbar-actions { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }

        /* ===== BUTTONS ===== */
        .btn { padding: 0.7rem 1.4rem; border: none; border-radius: 0.75rem; cursor: pointer; font-size: 0.95rem; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.6rem; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
        .btn-primary { background: linear-gradient(135deg, var(--accent-blue), #2563eb); color: white; }
        .btn-success { background: linear-gradient(135deg, var(--accent-green), #059669); color: white; }
        .btn-warning { background: linear-gradient(135deg, var(--accent-gold), #f59e0b); color: #000; }
        .btn-danger { background: linear-gradient(135deg, var(--accent-red), #dc2626); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--border-color); color: var(--text-primary); box-shadow: none; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.25); }
        .btn:active { transform: translateY(-1px); }

        /* ===== THEME TOGGLE ===== */
        .theme-toggle { width: 56px; height: 30px; background: var(--bg-card); border-radius: 15px; position: relative; cursor: pointer; border: 2px solid var(--border-color); transition: all 0.3s; }
        .theme-toggle:hover { border-color: var(--accent-gold); }
        .theme-toggle-slider { width: 24px; height: 24px; background: linear-gradient(135deg, var(--accent-gold), #f59e0b); border-radius: 50%; position: absolute; top: 1px; right: 1px; transition: transform 0.3s; box-shadow: 0 2px 6px rgba(0,0,0,0.3); }
        [data-theme="light"] .theme-toggle-slider { transform: translateX(-26px); }

        .credit-badge { background: linear-gradient(135deg, var(--accent-gold), #f59e0b); color: #000; padding: 0.6rem 1.2rem; border-radius: 2rem; font-weight: bold; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.6rem; box-shadow: 0 4px 12px rgba(251,191,36,0.4); }

        /* ===== CARDS ===== */
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        @media (max-width: 768px) { .cards-grid { grid-template-columns: 1fr; } }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 1.2rem; padding: 1.8rem; transition: all 0.4s; backdrop-filter: blur(10px); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--accent-gold), #f59e0b, var(--accent-gold)); background-size: 200% 100%; animation: shimmer 3s linear infinite; }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        .card:hover { transform: translateY(-6px); box-shadow: 0 12px 30px rgba(251,191,36,0.2); border-color: var(--accent-gold); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); }
        .card-title { font-size: 1.15rem; font-weight: 700; display: flex; align-items: center; gap: 0.7rem; }
        .card-icon { font-size: 1.8rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .price-value { font-size: 2.2rem; font-weight: bold; background: linear-gradient(135deg, var(--accent-gold), #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-align: center; margin: 1.5rem 0; filter: drop-shadow(0 2px 4px rgba(251,191,36,0.3)); }
        .price-label { text-align: center; color: var(--text-secondary); font-size: 0.95rem; font-weight: 500; }

        /* ===== SIGNALS ===== */
        .signal-buy, .signal-sell, .signal-hold, .signal-warning {
            padding: 1.2rem; border-radius: 0.9rem; text-align: center; font-weight: bold; margin-top: 1.5rem; font-size: 1.05rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .signal-buy { background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(16,185,129,0.25)); border: 2px solid var(--accent-green); color: var(--accent-green); }
        .signal-sell { background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.25)); border: 2px solid var(--accent-red); color: var(--accent-red); }
        .signal-hold { background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(251,191,36,0.25)); border: 2px solid var(--accent-gold); color: var(--accent-gold); }
        .signal-warning { background: linear-gradient(135deg, rgba(249,115,22,0.15), rgba(249,115,22,0.25)); border: 2px solid #f97316; color: #f97316; }

        .signal-best-buy {
            background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(16,185,129,0.35));
            border: 3px solid var(--accent-green); color: var(--accent-green);
            padding: 1.2rem; border-radius: 0.9rem; text-align: center; font-weight: bold; font-size: 1.1rem;
            animation: pulse-green 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(16,185,129,0.3);
        }
        .signal-best-sell {
            background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(239,68,68,0.35));
            border: 3px solid var(--accent-red); color: var(--accent-red);
            padding: 1.2rem; border-radius: 0.9rem; text-align: center; font-weight: bold; font-size: 1.1rem;
            animation: pulse-red 2s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(239,68,68,0.3);
        }
        .signal-good-buy {
            background: linear-gradient(135deg, rgba(16,185,129,0.15), rgba(16,185,129,0.2));
            border: 2px solid var(--accent-green); color: var(--accent-green);
            padding: 1.2rem; border-radius: 0.9rem; text-align: center; font-weight: bold; font-size: 1.05rem;
        }
        .signal-caution {
            background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(251,191,36,0.2));
            border: 2px solid var(--accent-gold); color: var(--accent-gold);
            padding: 1.2rem; border-radius: 0.9rem; text-align: center; font-weight: bold; font-size: 1.05rem;
        }
        .signal-normal {
            background: rgba(100,116,139,0.1); border: 2px solid var(--text-secondary); color: var(--text-secondary);
            padding: 1.2rem; border-radius: 0.9rem; text-align: center; font-weight: bold; font-size: 1.05rem;
        }
        @keyframes pulse-green { 0%,100% { box-shadow: 0 0 20px rgba(16,185,129,0.3); transform: scale(1); } 50% { box-shadow: 0 0 35px rgba(16,185,129,0.7); transform: scale(1.02); } }
        @keyframes pulse-red { 0%,100% { box-shadow: 0 0 20px rgba(239,68,68,0.3); transform: scale(1); } 50% { box-shadow: 0 0 35px rgba(239,68,68,0.7); transform: scale(1.02); } }

        /* ===== CHART ===== */
        .chart-container { position: relative; height: 220px; margin-top: 1.5rem; }

        /* ===== MODAL ===== */
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 2000; align-items: center; justify-content: center; padding: 1rem; backdrop-filter: blur(8px); }
        .modal.show { display: flex; }
        .modal-content { background: var(--bg-secondary); padding: 2.5rem; border-radius: 1.5rem; max-width: 520px; width: 100%; max-height: 90vh; overflow-y: auto; border: 2px solid var(--border-color); box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid var(--border-color); }
        .modal-close { font-size: 2rem; cursor: pointer; color: var(--text-secondary); transition: all 0.3s; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .modal-close:hover { color: var(--accent-red); background: rgba(239,68,68,0.1); transform: rotate(90deg); }

        input, select, textarea { width: 100%; padding: 0.9rem; margin: 0.6rem 0; border: 2px solid var(--border-color); border-radius: 0.75rem; background: var(--bg-card); color: var(--text-primary); font-size: 1rem; transition: all 0.3s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }

        .success, .error, .info-box { padding: 1rem; border-radius: 0.75rem; margin: 0.8rem 0; border: 1px solid; }
        .success { background: rgba(16,185,129,0.15); border-color: var(--accent-green); color: var(--accent-green); }
        .error { background: rgba(239,68,68,0.15); border-color: var(--accent-red); color: var(--accent-red); }
        .info-box { background: rgba(59,130,246,0.1); border-color: var(--accent-blue); font-size: 0.9rem; line-height: 1.7; }

        /* ===== ALGO CARDS ===== */
        .algo-card { background: var(--bg-card); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; border: 1px solid var(--border-color); transition: all 0.3s; }
        .algo-card:hover { border-color: var(--accent-gold); box-shadow: 0 4px 12px rgba(251,191,36,0.15); }
        .algo-title { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.6rem; font-weight: 500; }
        .algo-value { font-size: 1.3rem; font-weight: bold; color: var(--accent-gold); }
        .market-value { background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.15)); border: 2px solid var(--accent-blue); padding: 1rem; border-radius: 0.75rem; margin-top: 1.5rem; }

        /* ===== ANALYSIS CARDS (screenshot style) ===== */
        .analysis-card { background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 1.2rem; padding: 0; overflow: hidden; transition: all 0.3s; margin-bottom: 1.5rem; }
        .analysis-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
        .analysis-header { background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(245,158,11,0.1)); padding: 1.5rem; border-bottom: 2px solid var(--border-color); display: flex; align-items: center; gap: 0.75rem; }
        .analysis-icon { font-size: 2rem; }
        .analysis-title { font-size: 1.2rem; font-weight: bold; color: var(--text-primary); }
        .analysis-body { padding: 1.5rem; }

        /* price-comparison: 2 boxes side by side (like screenshot) */
        .price-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
        @media (max-width: 500px) { .price-comparison { grid-template-columns: 1fr; } }
        .price-box { background: var(--bg-primary); padding: 1.2rem; border-radius: 0.75rem; border: 2px solid var(--border-color); text-align: center; }
        .price-box.green-border { border-color: var(--accent-green); }
        .price-box.blue-border { border-color: var(--accent-blue); }
        .price-box-label { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.6rem; }
        .price-box-value { font-size: 1.4rem; font-weight: bold; color: var(--accent-gold); }
        .price-box-unit { font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.3rem; }

        /* difference badge: big colored box */
        .difference-box { background: var(--bg-primary); border: 2px solid var(--border-color); border-radius: 0.75rem; padding: 1rem 1.2rem; margin: 1rem 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem; }
        .difference-left { display: flex; flex-direction: column; gap: 0.2rem; }
        .difference-value-big { font-size: 1.6rem; font-weight: bold; }
        .difference-value-big.green { color: var(--accent-green); }
        .difference-value-big.red { color: var(--accent-red); }
        .difference-value-big.blue { color: var(--accent-blue); }
        .difference-arrow { font-size: 1.2rem; }
        .difference-right { text-align: left; font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6; }

        /* interpretation box */
        .interpretation { background: rgba(59,130,246,0.05); border-right: 4px solid var(--accent-blue); padding: 1rem 1.2rem; border-radius: 0 0.5rem 0.5rem 0; margin-top: 1rem; font-size: 0.9rem; line-height: 1.7; color: var(--text-secondary); }
        .interpretation-title { font-weight: bold; color: var(--accent-blue); margin-bottom: 0.4rem; font-size: 0.95rem; }

        /* ===== DISCLAIMER ===== */
        .disclaimer { background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(239,68,68,0.05)); border: 2px solid var(--accent-red); border-radius: 0.9rem; padding: 1.2rem; margin-bottom: 2rem; font-size: 0.9rem; line-height: 1.7; color: var(--text-secondary); }
        .disclaimer-title { font-weight: bold; color: var(--accent-red); margin-bottom: 0.5rem; font-size: 1rem; }

        /* ===== SIGNAL CARD (for signals page) ===== */
        .signal-card { background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1rem; transition: all 0.3s; }
        .signal-card:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.2); }
        .signal-card.high-buy { border-color: var(--accent-green); background: linear-gradient(135deg, rgba(16,185,129,0.08), var(--bg-card)); }
        .signal-card.high-sell { border-color: var(--accent-red); background: linear-gradient(135deg, rgba(239,68,68,0.08), var(--bg-card)); }
        .signal-card.med { border-color: var(--accent-gold); background: linear-gradient(135deg, rgba(251,191,36,0.08), var(--bg-card)); }
        .signal-card.low { border-color: var(--accent-blue); background: linear-gradient(135deg, rgba(59,130,246,0.08), var(--bg-card)); }
        .signal-card-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
        .signal-card-title { font-size: 1.1rem; font-weight: bold; }
        .signal-card-desc { font-size: 0.95rem; color: var(--text-secondary); line-height: 1.6; }
        .signal-priority-badge { font-size: 0.75rem; font-weight: bold; padding: 0.25rem 0.6rem; border-radius: 1rem; }
        .signal-priority-badge.high { background: rgba(239,68,68,0.2); color: var(--accent-red); }
        .signal-priority-badge.medium { background: rgba(251,191,36,0.2); color: var(--accent-gold); }
        .signal-priority-badge.low { background: rgba(59,130,246,0.2); color: var(--accent-blue); }

        /* ===== NOTIFICATION ===== */
        .notification { position: fixed; top: 2rem; left: 50%; transform: translateX(-50%) translateY(-120px); background: var(--bg-secondary); border: 2px solid var(--border-color); padding: 1.2rem 1.8rem; border-radius: 1rem; box-shadow: 0 12px 40px rgba(0,0,0,0.4); z-index: 3000; opacity: 0; transition: all 0.4s cubic-bezier(0.68,-0.55,0.265,1.55); max-width: 450px; backdrop-filter: blur(10px); }
        .notification.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        .loading { display: inline-block; width: 22px; height: 22px; border: 3px solid var(--border-color); border-top-color: var(--accent-gold); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .edit-btn { background: linear-gradient(135deg, var(--accent-gold), #f59e0b); color: #000; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.85rem; font-weight: 600; transition: all 0.3s; margin-top: 0.75rem; width: 100%; }
        .edit-btn:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(251,191,36,0.4); }
        .edit-btn:disabled { background: #4b5563; color: #9ca3af; cursor: not-allowed; }

        /* ===== WELCOME ===== */
        .welcome-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 2rem; position: relative; z-index: 1; }
        .welcome-card { background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 2rem; padding: 3rem; max-width: 600px; text-align: center; backdrop-filter: blur(10px); box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .welcome-title { font-size: 3rem; margin-bottom: 1rem; background: linear-gradient(135deg, var(--accent-gold), #f59e0b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .welcome-subtitle { color: var(--text-secondary); font-size: 1.2rem; margin-bottom: 3rem; line-height: 1.8; }

        @media (max-width: 768px) {
            .price-value { font-size: 1.8rem; }
            .card { padding: 1.2rem; }
            .topbar { padding: 1rem; }
            .welcome-card { padding: 2rem; }
            .welcome-title { font-size: 2rem; }
        }
    </style>
</head>
<body>

<!-- Welcome Screen -->
<div id="welcomeScreen" class="welcome-screen" style="display:none;">
    <div class="welcome-card">
        <div class="logo-icon" style="font-size:4rem;margin-bottom:1rem;">ğŸ’</div>
        <h1 class="welcome-title">Ú¯Ù„Ø¯ÛŒØ§Ø± Ù¾Ø±Ùˆ</h1>
        <p class="welcome-subtitle">ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§ Ùˆ Ø§Ø±Ø²<br>âœ¨ Ù‚ÛŒÙ…Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ | ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ø¯Ù‚ÛŒÙ‚ | ğŸ¯ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯</p>
        <div style="display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="showAuth('login')" style="padding:1rem 2.5rem;font-size:1.1rem;">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨</button>
            <button class="btn btn-warning" onclick="showAuth('register')" style="padding:1rem 2.5rem;font-size:1.1rem;">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø±Ø§ÛŒÚ¯Ø§Ù†</button>
        </div>
    </div>
</div>

<!-- Sidebar -->
<div class="sidebar hidden" id="sidebar">
    <div class="logo"><span class="logo-icon">ğŸ’</span><span class="logo-text">Ú¯Ù„Ø¯ÛŒØ§Ø± Ù¾Ø±Ùˆ</span></div>
    <div class="user-info" id="userInfo"></div>
    <div class="nav-item active" onclick="switchPage('prices')" data-page="prices"><span class="nav-icon">ğŸ’°</span><span>Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡</span></div>
    <div class="nav-item" onclick="switchPage('analysis')" data-page="analysis"><span class="nav-icon">ğŸ“Š</span><span>ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§</span></div>
    <div class="nav-item" onclick="switchPage('signals')" data-page="signals"><span class="nav-icon">ğŸ¯</span><span>Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ</span></div>
    <div class="nav-item" onclick="switchPage('calculator')" data-page="calculator"><span class="nav-icon">ğŸ§®</span><span>Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</span></div>
    <div class="nav-item" onclick="switchPage('settings')" data-page="settings"><span class="nav-icon">âš™ï¸</span><span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span></div>
    <div style="margin-top:2rem;"><button class="btn btn-danger" onclick="logout()" style="width:100%;"><span>ğŸšª</span><span>Ø®Ø±ÙˆØ¬</span></button></div>
</div>

<!-- Main Content -->
<div class="main-content" id="mainContent" style="display:none;">
    <div class="topbar">
        <div style="display:flex;align-items:center;gap:1rem;">
            <div class="hamburger" onclick="toggleSidebar()">â˜°</div>
            <h1 style="font-size:1.6rem;" id="pageTitle">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</h1>
        </div>
        <div class="topbar-actions">
            <div class="credit-badge" id="creditBadge"><span>â­</span><span>Ø§ÙØªØªØ§Ø­ÛŒÙ‡ - Ù¾Ø±Ùˆ Ø±Ø§ÛŒÚ¯Ø§Ù†!</span></div>
            <div class="theme-toggle" onclick="toggleTheme()"><div class="theme-toggle-slider"></div></div>
            <button class="btn btn-outline" onclick="fetchLivePrices()" title="Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§"><span>ğŸ”„</span></button>
        </div>
    </div>
    <div id="pageContent"></div>
</div>

<!-- Notification -->
<div class="notification" id="notification"></div>

<!-- Auth Modal -->
<div id="authModal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><h2 id="authTitle">ÙˆØ±ÙˆØ¯</h2><span class="modal-close" onclick="closeModal('authModal')">Ã—</span></div>
        <input type="email" id="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„">
        <input type="password" id="pass" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø­Ø¯Ø§Ù‚Ù„ 6 Ú©Ø§Ø±Ø§Ú©ØªØ±)">
        <div id="authMsg"></div>
        <button class="btn btn-primary" onclick="doAuth()" style="width:100%;margin-top:1.5rem;padding:1rem;"><span id="authBtnText">ØªØ§ÛŒÛŒØ¯</span></button>
        <div style="text-align:center;margin-top:1.5rem;"><a href="#" onclick="switchAuthMode()" style="color:var(--accent-blue);text-decoration:none;" id="switchAuthLink">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ</a></div>
    </div>
</div>

<!-- Edit Price Modal -->
<div id="editPriceModal" class="modal">
    <div class="modal-content">
        <div class="modal-header"><h2 id="editPriceTitle">ÙˆÛŒØ±Ø§ÛŒØ´ Ù‚ÛŒÙ…Øª</h2><span class="modal-close" onclick="closeModal('editPriceModal')">Ã—</span></div>
        <div class="info-box" id="currentPriceInfo"></div>
        <label style="display:block;margin-bottom:0.5rem;font-weight:600;">Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯:</label>
        <input type="number" id="newPrice" placeholder="Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" step="0.01">
        <button class="btn btn-primary" onclick="saveEditedPrice()" style="width:100%;margin-top:1.5rem;padding:1rem;">âœ… Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
    </div>
</div>

<script>
// ============================================================
// CONFIG & STATE
// ============================================================
const WORKER_API_URL = 'https://fancy-cloud-73d3.yousef7777t.workers.dev/api/price';

const DB = {
    getUsers: () => JSON.parse(localStorage.getItem('goldyar_users') || '[]'),
    saveUsers: u => localStorage.setItem('goldyar_users', JSON.stringify(u)),
    getCurrentUser: () => JSON.parse(localStorage.getItem('goldyar_current_user') || 'null'),
    setCurrentUser: u => localStorage.setItem('goldyar_current_user', JSON.stringify(u)),
    logout: () => localStorage.removeItem('goldyar_current_user'),
    getPrices: () => JSON.parse(localStorage.getItem('goldyar_prices') || 'null'),
    savePrices: p => localStorage.setItem('goldyar_prices', JSON.stringify(p))
};

let app = {
    user: null,
    isPro: true,
    currentPage: 'prices',
    theme: localStorage.getItem('theme') || 'dark',
    authMode: 'login',
    editingPrice: null,
    prices: {
        goldPrice: 2035,
        silverPrice: 25,
        usdRate: 580000000,
        mesghalMarket: 0,
        geram18Market: 0,
        dirhamRate: 158000,
        coinPrice: 0,
        gold18UAE: 335,
        bourse: 0,
        brent: 0,
        tether: 570000000,
        btc: 0
    },
    priceHistory: [],
    signals: []           // âœ… Ø§ØµÙ„Ø§Ø­: Ø¢Ø±Ø§ÛŒÙ‡ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§
};

// ============================================================
// UTILITY
// ============================================================
function formatNumber(n) { return new Intl.NumberFormat('fa-IR').format(Math.round(n)); }
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('show'); }
function toggleTheme() { app.theme = app.theme === 'dark' ? 'light' : 'dark'; document.documentElement.setAttribute('data-theme', app.theme); localStorage.setItem('theme', app.theme); }
function showNotification(msg, type = 'success') {
    const n = document.getElementById('notification');
    n.textContent = msg; n.className = `notification ${type}`; n.classList.add('show');
    setTimeout(() => n.classList.remove('show'), 3500);
}
function closeModal(id) { document.getElementById(id).classList.remove('show'); }

// ============================================================
// AUTH
// ============================================================
function showAuth(mode) {
    app.authMode = mode;
    document.getElementById('authTitle').textContent = mode === 'login' ? 'ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨' : 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø±Ø§ÛŒÚ¯Ø§Ù†';
    document.getElementById('authBtnText').textContent = mode === 'login' ? 'ÙˆØ±ÙˆØ¯' : 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…';
    document.getElementById('switchAuthLink').textContent = mode === 'login' ? 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ' : 'Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ';
    document.getElementById('email').value = '';
    document.getElementById('pass').value = '';
    document.getElementById('authMsg').innerHTML = '';
    document.getElementById('authModal').classList.add('show');
}
function switchAuthMode() { showAuth(app.authMode === 'login' ? 'register' : 'login'); }
function doAuth() {
    const email = document.getElementById('email').value.trim();
    const pass = document.getElementById('pass').value;
    const msg = document.getElementById('authMsg');
    if (!email || !pass) { msg.innerHTML = '<div class="error">âŒ Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</div>'; return; }
    if (!email.includes('@')) { msg.innerHTML = '<div class="error">âŒ Ø§ÛŒÙ…ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª</div>'; return; }
    if (pass.length < 6) { msg.innerHTML = '<div class="error">âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 6 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯</div>'; return; }
    const users = DB.getUsers();
    if (app.authMode === 'register') {
        if (users.find(u => u.email === email)) { msg.innerHTML = '<div class="error">âŒ Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª</div>'; return; }
        const u = { email, password: pass, isPro: true, credit: 30, createdAt: new Date().toISOString() };
        users.push(u); DB.saveUsers(users); DB.setCurrentUser(u);
        app.user = u; app.isPro = true;
        closeModal('authModal'); showNotification('âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!'); initDashboard();
    } else {
        const u = users.find(x => x.email === email && x.password === pass);
        if (!u) { msg.innerHTML = '<div class="error">âŒ Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª</div>'; return; }
        u.isPro = true; DB.setCurrentUser(u); app.user = u; app.isPro = true;
        const saved = DB.getPrices(); if (saved) app.prices = saved;
        closeModal('authModal'); showNotification('âœ… Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!'); initDashboard();
    }
}
function logout() {
    if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø§Ø² Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
        DB.logout(); app.user = null; app.isPro = false;
        document.getElementById('welcomeScreen').style.display = 'flex';
        document.getElementById('mainContent').style.display = 'none';
        document.getElementById('sidebar').classList.add('hidden');
        showNotification('Ø®Ø±ÙˆØ¬ Ù…ÙˆÙÙ‚');
    }
}
function initDashboard() {
    document.getElementById('welcomeScreen').style.display = 'none';
    document.getElementById('mainContent').style.display = 'block';
    document.getElementById('sidebar').classList.remove('hidden');
    updateUserInfo();
    calculateSignals();   // âœ… Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ Ù‡Ù†Ú¯Ø§Ù… Ø´Ø±ÙˆØ¹
    renderPage();
}
function updateUserInfo() {
    document.getElementById('userInfo').innerHTML = `
        <div class="user-email">${app.user?.email || 'Ù…Ù‡Ù…Ø§Ù†'}</div>
        <div class="user-status">â­ Ø§ÙØªØªØ§Ø­ÛŒÙ‡ - Ù¾Ø±Ùˆ Ø±Ø§ÛŒÚ¯Ø§Ù†</div>`;
}

// ============================================================
// PAGE SWITCHING
// ============================================================
function switchPage(page) {
    app.currentPage = page;
    document.querySelectorAll('.nav-item').forEach(i => { i.classList.remove('active'); if (i.dataset.page === page) i.classList.add('active'); });
    const titles = { prices:'Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡', analysis:'ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ', signals:'Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ', calculator:'Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø·Ù„Ø§', settings:'ØªÙ†Ø¸ÛŒÙ…Ø§Øª' };
    document.getElementById('pageTitle').textContent = titles[page] || page;
    renderPage();
    if (window.innerWidth <= 968) document.getElementById('sidebar').classList.remove('show');
}

// ============================================================
// FETCH LIVE PRICES
// ============================================================
async function fetchLivePrices() {
    showNotification('Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯...', 'info');
    try {
        console.log('URL worker:', WORKER_API_URL);
        const res = await fetch(WORKER_API_URL, { cache: 'no-store' });
        console.log('ÙˆØ¶Ø¹ÛŒØª HTTP:', res.status, res.ok ? 'OK' : 'ERROR');

        if (!res.ok) {
            const errText = await res.text();
            console.error('Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ± Ù†Ø§Ù…ÙˆÙÙ‚:', errText);
            throw new Error(`ÙˆØ¶Ø¹ÛŒØª ${res.status}`);
        }

        const data = await res.json();
        console.log('Ø¯Ø§Ø¯Ù‡ Ú©Ø§Ù…Ù„ Ø¯Ø±ÛŒØ§ÙØªÛŒ:', data);  // Ø§ÛŒÙ† Ø±Ø§ Ú†Ú© Ú©Ù†ÛŒØ¯

        let updated = false;

        const map = {
            'Ø§Ù†Ø³_Ø·Ù„Ø§': 'goldPrice',
            'Ø§Ù†Ø³_Ù†Ù‚Ø±Ù‡': 'silverPrice',
            'Ø¯Ù„Ø§Ø±': 'usdRate',
            'Ù…Ø«Ù‚Ø§Ù„_Ø·Ù„Ø§': 'mesghalMarket',
            'Ø·Ù„Ø§ÛŒ_18_Ø¹ÛŒØ§Ø±': 'geram18Market',
            'Ø³Ú©Ù‡_ØªÙ…Ø§Ù…': 'coinPrice',
            'Ø¯Ø±Ù‡Ù…': 'dirhamRate',
            'ØªØªØ±': 'tether',
            'Ø¨ÛŒØª_Ú©ÙˆÛŒÙ†': 'btc',
            'Ø¨ÙˆØ±Ø³_ØªÙ‡Ø±Ø§Ù†': 'bourse',
            'Ù†ÙØª_Ø¨Ø±Ù†Øª': 'brent',
            'Ø·Ù„Ø§ÛŒ_18_Ø§Ù…Ø§Ø±Ø§Øª': 'gold18UAE'
        };

        for (const [srcKey, appKey] of Object.entries(map)) {
            if (data[srcKey] && data[srcKey].price != null) {
                app.prices[appKey] = data[srcKey].price;
                // Ø¢Ù¾Ø¯ÛŒØª UI Ø³Ù„ÙˆÙ„
                const cellMap = { /* Ù‡Ù…Ø§Ù† Ù‚Ø¨Ù„ÛŒ */ };
                if (cellMap[appKey]) {
                    const div = document.getElementById(cellMap[appKey]);
                    if (div) {
                        const displayVal = ['usdRate','mesghalMarket','geram18Market','coinPrice','tether','dirhamRate'].includes(appKey)
                            ? data[srcKey].price / 10
                            : data[srcKey].price;
                        div.textContent = formatNumber(displayVal);
                        div.style.background = 'rgba(251,191,36,0.3)';
                        setTimeout(() => div.style.background = '', 800);
                    }
                }
                updated = true;
            } else {
                console.warn(`ÙÛŒÙ„Ø¯ ${srcKey} Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ ÛŒØ§ price Ù†Ø¯Ø§Ø±Ø¯`);
            }
        }

        // Ø¨Ù‚ÛŒÙ‡ Ú©Ø¯ (silver calc, history, signals, notification...)
        if (updated) {
            // Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø±ÙØ±Ø´
            DB.savePrices(app.prices);
            app.priceHistory.push({ timestamp: Date.now(), ...app.prices });
            if (app.priceHistory.length > 50) app.priceHistory = app.priceHistory.slice(-50);
            // Ø²Ù…Ø§Ù†
            const te = document.getElementById('lastUpdateTime');
            if (te && data.Ø¢Ø®Ø±ÛŒÙ†_Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ) {
                te.innerHTML = `ğŸ“¡ Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: <strong>${data.Ø¢Ø®Ø±ÛŒÙ†_Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ.jalali_date}</strong> Ø³Ø§Ø¹Øª <strong>${data.Ø¢Ø®Ø±ÛŒÙ†_Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ.jalali_time}</strong>`;
            }
            calculateSignals();
            showNotification('âœ… Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯');
            if (app.currentPage === 'prices') setTimeout(renderCharts, 100);
            if (app.currentPage === 'signals') renderPage();
        } else {
            showNotification('âš ï¸ Ù‡ÛŒÚ† Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ø´Ø¯', 'error');
        }

    } catch (e) {
        console.error('Ø®Ø·Ø§ÛŒ fetchLivePrices:', e);
        showNotification('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ ÛŒØ§ Ù¾Ø±Ø¯Ø§Ø²Ø´: ' + e.message, 'error');
    }
}

function updateTableCell(id, value) {
    const c = document.getElementById(id);
    if (c) { c.style.background = 'rgba(251,191,36,0.3)'; c.textContent = value; setTimeout(() => c.style.background = '', 600); }
}

// ============================================================
// PRICE EDIT
// ============================================================
function showEditPrice(key, title, val, unit) {
    app.editingPrice = { key, title, unit };
    document.getElementById('editPriceTitle').textContent = `ÙˆÛŒØ±Ø§ÛŒØ´ ${title}`;
    document.getElementById('currentPriceInfo').innerHTML = `<strong>Ù‚ÛŒÙ…Øª ÙØ¹Ù„ÛŒ:</strong> ${formatNumber(val)} ${unit}`;
    document.getElementById('newPrice').value = val;
    document.getElementById('editPriceModal').classList.add('show');
}
function saveEditedPrice() {
    const v = parseFloat(document.getElementById('newPrice').value);
    if (!v || v <= 0 || isNaN(v)) { showNotification('âŒ Ù‚ÛŒÙ…Øª Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª', 'error'); return; }
    app.prices[app.editingPrice.key] = v;
    DB.savePrices(app.prices);
    closeModal('editPriceModal');
    showNotification(`âœ… ${app.editingPrice.title} Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯`);
    calculateSignals();
    renderPage();
}

// ============================================================
// CALCULATE (ØªØ­Ù„ÛŒÙ„)
// ============================================================
function calculate() {
    const p = app.prices;
    const mesghalTheo = (p.goldPrice * p.usdRate) / 9.5742;
    const diffMesghal = mesghalTheo - p.mesghalMarket;
    const mesghalPercent = p.mesghalMarket ? ((diffMesghal / p.mesghalMarket) * 100).toFixed(2) : '0';

    const geram18Theo1 = ((p.goldPrice / 31.1035) * p.usdRate) * 0.75;
    const geram18Theo2 = (p.goldPrice * p.usdRate / 31.103) * 0.750;
    const geram18Theo3 = (p.goldPrice * p.usdRate) / 41.4265;
    const geram18Avg = (geram18Theo1 + geram18Theo2 + geram18Theo3) / 3;
    const diffGeram18 = geram18Avg - p.geram18Market;

    const coinRatio = p.geram18Market ? (p.coinPrice / p.geram18Market).toFixed(2) : '0';
    const coinSignal = coinRatio <= 9.7 ? 'buy_coin' : coinRatio >= 11.3 ? 'buy_gold' : 'hold';
    const gsRatio = p.silverPrice ? (p.goldPrice / p.silverPrice).toFixed(2) : '0';

    const realUsdPrice = p.goldPrice ? (p.geram18Market / p.goldPrice) * 41.5 : 0;
    const usdDiff = realUsdPrice - p.usdRate;
    const usdSignal = usdDiff > 20000000 ? 'negative_bubble' : usdDiff < -20000000 ? 'positive_bubble' : 'normal';

    const dirhamUsdCalc = p.dirhamRate * 3.67;
    const dirhamUsdDiff = dirhamUsdCalc - p.usdRate;
    const dirhamUsdSignal = Math.abs(dirhamUsdDiff) > 10000000 ? (dirhamUsdDiff > 0 ? 'expensive' : 'cheap') : 'normal';

    const uaeGold18Calc = p.dirhamRate * p.gold18UAE;
    const uaeGoldDiff = uaeGold18Calc - p.geram18Market;

    let uaeGoldSignal = 'normal', uaeGoldSignalText = 'ÙˆØ¶Ø¹ÛŒØª Ø¹Ø§Ø¯ÛŒ';
    if (uaeGoldDiff > 9000000)       { uaeGoldSignal = 'best_buy_iran';  uaeGoldSignalText = 'ğŸŸ¢ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ø§Ø² Ø§ÛŒØ±Ø§Ù†'; }
    else if (uaeGoldDiff > 7000000)  { uaeGoldSignal = 'good_buy_iran';  uaeGoldSignalText = 'ğŸŸ¢ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ø§Ø² Ø§ÛŒØ±Ø§Ù†'; }
    else if (uaeGoldDiff > 3500000)  { uaeGoldSignal = 'step_buy';       uaeGoldSignalText = 'ğŸŸ¡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ'; }
    else if (uaeGoldDiff < -9000000) { uaeGoldSignal = 'best_sell_iran'; uaeGoldSignalText = 'ğŸ”´ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ø§Ø² Ø§ÛŒØ±Ø§Ù†'; }
    else if (uaeGoldDiff < -7000000) { uaeGoldSignal = 'good_sell_iran'; uaeGoldSignalText = 'ğŸ”´ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ø§Ø² Ø§ÛŒØ±Ø§Ù†'; }
    else if (uaeGoldDiff < -3500000) { uaeGoldSignal = 'step_sell';      uaeGoldSignalText = 'ğŸŸ¡ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ù¾Ù„Ù‡â€ŒØ§ÛŒ'; }

    return { mesghalTheo, diffMesghal, mesghalPercent, geram18Theo1, geram18Theo2, geram18Theo3, geram18Avg, diffGeram18, coinRatio, coinSignal, gsRatio, realUsdPrice, usdDiff, usdSignal, dirhamUsdCalc, dirhamUsdDiff, dirhamUsdSignal, uaeGold18Calc, uaeGoldDiff, uaeGoldSignal, uaeGoldSignalText };
}

// ============================================================
// âœ… CALCULATE SIGNALS â€” Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù‚Ø¨Ù„Ø§Ù‹ Ù†Ø¯Ø§Ø´ØªÛŒØ¯!
// ============================================================
function calculateSignals() {
    app.signals = [];
    const c = calculate();
    const p = app.prices;

    // --- Ù…Ø«Ù‚Ø§Ù„ ---
    if (c.diffMesghal > 10000000) {
        app.signals.push({ type:'buy', priority:'high', title:'ğŸŸ¢ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ù…Ø«Ù‚Ø§Ù„ Ø·Ù„Ø§', description:`Ù‚ÛŒÙ…Øª ØªØ¦ÙˆØ±ÛŒ ${formatNumber(c.mesghalTheo/10)} ØªÙˆÙ…Ø§Ù†ØŒ Ø¨Ø§Ø²Ø§Ø± ${formatNumber(p.mesghalMarket/10)} ØªÙˆÙ…Ø§Ù† â€” Ø§Ø®ØªÙ„Ø§Ù ${formatNumber(Math.abs(c.diffMesghal)/10)} ØªÙˆÙ…Ø§Ù†` });
    } else if (c.diffMesghal > 5000000) {
        app.signals.push({ type:'buy', priority:'medium', title:'ğŸŸ¡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ù…ØªÙˆØ³Ø· Ù…Ø«Ù‚Ø§Ù„ Ø·Ù„Ø§', description:`Ø§Ø®ØªÙ„Ø§Ù Ù‚ÛŒÙ…Øª ØªØ¦ÙˆØ±ÛŒ Ùˆ Ø¨Ø§Ø²Ø§Ø±: ${formatNumber(Math.abs(c.diffMesghal)/10)} ØªÙˆÙ…Ø§Ù†` });
    } else if (c.diffMesghal < -10000000) {
        app.signals.push({ type:'sell', priority:'high', title:'ğŸ”´ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ù…Ø«Ù‚Ø§Ù„ Ø·Ù„Ø§', description:`Ø¨Ø§Ø²Ø§Ø± ${formatNumber(Math.abs(c.diffMesghal)/10)} ØªÙˆÙ…Ø§Ù† Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù‚ÛŒÙ…Øª ØªØ¦ÙˆØ±ÛŒ` });
    } else if (c.diffMesghal < -5000000) {
        app.signals.push({ type:'sell', priority:'medium', title:'ğŸ”´ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ù…ØªÙˆØ³Ø· Ù…Ø«Ù‚Ø§Ù„', description:`Ø¨Ø§Ø²Ø§Ø± ${formatNumber(Math.abs(c.diffMesghal)/10)} ØªÙˆÙ…Ø§Ù† Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² ØªØ¦ÙˆØ±ÛŒ` });
    }

    // --- Ø·Ù„Ø§ÛŒ 18 ---
    if (c.diffGeram18 > 3000000) {
        app.signals.push({ type:'buy', priority:'high', title:'ğŸŸ¢ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø±', description:`Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† 3 Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…: ${formatNumber(c.geram18Avg/10)} ØªÙˆÙ…Ø§Ù†ØŒ Ø¨Ø§Ø²Ø§Ø±: ${formatNumber(p.geram18Market/10)} ØªÙˆÙ…Ø§Ù†` });
    } else if (c.diffGeram18 > 1000000) {
        app.signals.push({ type:'buy', priority:'medium', title:'ğŸŸ¡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ù…ØªÙˆØ³Ø· Ø·Ù„Ø§ÛŒ 18', description:`Ø§Ø®ØªÙ„Ø§Ù: ${formatNumber(Math.abs(c.diffGeram18)/10)} ØªÙˆÙ…Ø§Ù†` });
    } else if (c.diffGeram18 < -3000000) {
        app.signals.push({ type:'sell', priority:'high', title:'ğŸ”´ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø±', description:`Ø¨Ø§Ø²Ø§Ø± ${formatNumber(Math.abs(c.diffGeram18)/10)} ØªÙˆÙ…Ø§Ù† Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…â€ŒÙ‡Ø§` });
    }

    // --- Ø³Ú©Ù‡/Ø·Ù„Ø§ ---
    if (c.coinSignal === 'buy_coin') {
        app.signals.push({ type:'buy', priority:'high', title:'ğŸŸ¢ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡ - Ù†Ø³Ø¨Øª Ù¾Ø§ÛŒÛŒÙ†', description:`Ù†Ø³Ø¨Øª Ø³Ú©Ù‡ Ø¨Ù‡ Ø·Ù„Ø§: ${c.coinRatio} (Ú©Ù…ØªØ± Ø§Ø² Û¹.Û· = ÙØ±ØµØª Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡)` });
    } else if (c.coinSignal === 'buy_gold') {
        app.signals.push({ type:'sell', priority:'medium', title:'ğŸ”´ ÙØ±ÙˆØ´ Ø³Ú©Ù‡ / Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§', description:`Ù†Ø³Ø¨Øª Ø³Ú©Ù‡ Ø¨Ù‡ Ø·Ù„Ø§: ${c.coinRatio} (Ø¨ÛŒØ´ØªØ± Ø§Ø² Û±Û±.Û³ = Ø³Ú©Ù‡ Ú¯Ø±Ø§Ù†)` });
    }

    // --- Ø·Ù„Ø§/Ù†Ù‚Ø±Ù‡ ---
    if (parseFloat(c.gsRatio) < 60) {
        app.signals.push({ type:'buy', priority:'low', title:'ğŸ”µ Ù†Ù‚Ø±Ù‡ Ù†Ø³Ø¨ØªØ§Ù‹ Ø§Ø±Ø²Ø§Ù† Ø§Ø³Øª', description:`Ù†Ø³Ø¨Øª Ø·Ù„Ø§ Ø¨Ù‡ Ù†Ù‚Ø±Ù‡: ${c.gsRatio} (Ú©Ù…ØªØ± Ø§Ø² Û¶Û°)` });
    } else if (parseFloat(c.gsRatio) > 80) {
        app.signals.push({ type:'buy', priority:'low', title:'ğŸ”µ Ù†Ù‚Ø±Ù‡ ÙØ±ØµØª Ø®Ø±ÛŒØ¯ Ø¯Ø§Ø±Ø¯', description:`Ù†Ø³Ø¨Øª Ø·Ù„Ø§ Ø¨Ù‡ Ù†Ù‚Ø±Ù‡: ${c.gsRatio} (Ø¨ÛŒØ´ØªØ± Ø§Ø² Û¸Û° = Ù†Ù‚Ø±Ù‡ Ø§Ø±Ø²Ø§Ù†)` });
    }

    // --- Ø¯Ù„Ø§Ø± ÙˆØ§Ù‚Ø¹ÛŒ ---
    if (c.usdSignal === 'negative_bubble') {
        app.signals.push({ type:'buy', priority:'high', title:'ğŸŸ¢ Ø­Ø¨Ø§Ø¨ Ù…Ù†ÙÛŒ - ÙØ±ØµØª Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§', description:'Ø¯Ù„Ø§Ø± Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ú¯Ø±Ø§Ù† Ø§Ø³Øª. Ù‚ÛŒÙ…Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ù„Ø§Ø± Ø§Ø² Ø·Ù„Ø§ Ú©Ù…ØªØ± Ø§Ø³Øª.' });
    } else if (c.usdSignal === 'positive_bubble') {
        app.signals.push({ type:'sell', priority:'high', title:'ğŸ”´ Ø­Ø¨Ø§Ø¨ Ù…Ø«Ø¨Øª - Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯', description:'Ø¯Ù„Ø§Ø± Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ø§Ø±Ø²Ø§Ù† Ø§Ø³Øª Ù†Ø³Ø¨Øª Ø¨Ù‡ Ø·Ù„Ø§.' });
    }

    // --- Ø¯Ø±Ù‡Ù… / Ø¯Ù„Ø§Ø± ---
    if (c.dirhamUsdSignal === 'expensive') {
        app.signals.push({ type:'sell', priority:'medium', title:'ğŸ”´ Ø¯Ù„Ø§Ø± Ú¯Ø±Ø§Ù† Ø§Ø³Øª Ø§Ø² Ø¯Ø±Ù‡Ù…', description:`Ø¯Ù„Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ø§Ø² Ø¯Ø±Ù‡Ù…: ${formatNumber(c.dirhamUsdCalc/10)} ØªÙˆÙ…Ø§Ù†` });
    } else if (c.dirhamUsdSignal === 'cheap') {
        app.signals.push({ type:'buy', priority:'medium', title:'ğŸŸ¢ Ø¯Ù„Ø§Ø± Ø§Ø±Ø²Ø§Ù† Ø§Ø³Øª Ø§Ø² Ø¯Ø±Ù‡Ù…', description:`Ø¯Ù„Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ø§Ø² Ø¯Ø±Ù‡Ù…: ${formatNumber(c.dirhamUsdCalc/10)} ØªÙˆÙ…Ø§Ù†` });
    }

    // --- Ø·Ù„Ø§ÛŒ Ø§Ù…Ø§Ø±Ø§Øª ---
    if (c.uaeGoldDiff > 9000000) {
        app.signals.push({ type:'buy', priority:'high', title:'ğŸŸ¢ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¹Ø§Ù„ÛŒ Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§ Ø§Ø² Ø§ÛŒØ±Ø§Ù†', description:`Ø·Ù„Ø§ÛŒ Ø§Ù…Ø§Ø±Ø§Øª ${formatNumber(Math.abs(c.uaeGoldDiff)/10)} ØªÙˆÙ…Ø§Ù† Ú¯Ø±Ø§Ù†â€ŒØªØ± Ø§Ø² Ø§ÛŒØ±Ø§Ù†` });
    } else if (c.uaeGoldDiff > 7000000) {
        app.signals.push({ type:'buy', priority:'medium', title:'ğŸŸ¡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§ Ø§Ø² Ø§ÛŒØ±Ø§Ù†', description:`Ø·Ù„Ø§ÛŒ Ø§Ù…Ø§Ø±Ø§Øª ${formatNumber(Math.abs(c.uaeGoldDiff)/10)} ØªÙˆÙ…Ø§Ù† Ú¯Ø±Ø§Ù†â€ŒØªØ±` });
    } else if (c.uaeGoldDiff > 3500000) {
        app.signals.push({ type:'buy', priority:'low', title:'ğŸ”µ Ø®Ø±ÛŒØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø·Ù„Ø§ Ø§Ø² Ø§ÛŒØ±Ø§Ù†', description:`Ø§Ø®ØªÙ„Ø§Ù: ${formatNumber(Math.abs(c.uaeGoldDiff)/10)} ØªÙˆÙ…Ø§Ù†` });
    } else if (c.uaeGoldDiff < -9000000) {
        app.signals.push({ type:'sell', priority:'high', title:'ğŸ”´ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ø·Ù„Ø§ Ø¨Ù‡ Ø§Ù…Ø§Ø±Ø§Øª', description:`Ø§ÛŒØ±Ø§Ù† ${formatNumber(Math.abs(c.uaeGoldDiff)/10)} ØªÙˆÙ…Ø§Ù† Ú¯Ø±Ø§Ù†â€ŒØªØ±` });
    } else if (c.uaeGoldDiff < -3500000) {
        app.signals.push({ type:'sell', priority:'medium', title:'ğŸ”´ ÙØ±ÙˆØ´ Ø·Ù„Ø§ Ø¨Ù‡ Ø§Ù…Ø§Ø±Ø§Øª', description:`Ø§Ø®ØªÙ„Ø§Ù: ${formatNumber(Math.abs(c.uaeGoldDiff)/10)} ØªÙˆÙ…Ø§Ù†` });
    }

    // Sort: high first
    const order = { high:0, medium:1, low:2 };
    app.signals.sort((a, b) => (order[a.priority] || 2) - (order[b.priority] || 2));
}

// ============================================================
// RENDER PAGE ROUTER
// ============================================================
function renderPage() {
    const content = document.getElementById('pageContent');
    if (app.currentPage === 'prices')      { content.innerHTML = renderPricesPage();    setTimeout(renderCharts, 100); }
    else if (app.currentPage === 'analysis') { content.innerHTML = renderAnalysisPage(); }
    else if (app.currentPage === 'signals')  { content.innerHTML = renderSignalsPage();  }
    else if (app.currentPage === 'calculator') { content.innerHTML = renderCalculatorPage(); }
    else if (app.currentPage === 'settings')   { content.innerHTML = renderSettingsPage();  }
}

// ============================================================
// RENDER: PRICES PAGE
// ============================================================
function renderPricesPage() {
    const eb = (key, title, val, unit) => app.isPro
        ? `<button class="edit-btn" onclick="showEditPrice('${key}','${title}',${val},'${unit}')" style="padding:0.4rem 0.8rem;font-size:0.8rem;">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´</button>`
        : `<button class="edit-btn" disabled style="padding:0.4rem 0.8rem;font-size:0.8rem;">ğŸ”’ Ù‚ÙÙ„</button>`;

    const rows = [
        ['ğŸ“Š','Ø¨ÙˆØ±Ø³ ØªÙ‡Ø±Ø§Ù†','bourse-price',app.prices.bourse,1,'ÙˆØ§Ø­Ø¯','bourse','Ø¨ÙˆØ±Ø³ ØªÙ‡Ø±Ø§Ù†','ÙˆØ§Ø­Ø¯'],
        ['ğŸŒ','Ø§Ù†Ø³ Ø·Ù„Ø§ Ø¬Ù‡Ø§Ù†ÛŒ','gold-price',app.prices.goldPrice,1,'Ø¯Ù„Ø§Ø±','goldPrice','Ø§Ù†Ø³ Ø·Ù„Ø§','Ø¯Ù„Ø§Ø±'],
        ['âšª','Ø§Ù†Ø³ Ù†Ù‚Ø±Ù‡ Ø¬Ù‡Ø§Ù†ÛŒ','silver-price',app.prices.silverPrice,1,'Ø¯Ù„Ø§Ø±','silverPrice','Ø§Ù†Ø³ Ù†Ù‚Ø±Ù‡','Ø¯Ù„Ø§Ø±'],
        ['âš–ï¸','Ù…Ø«Ù‚Ø§Ù„ Ø·Ù„Ø§','mesghal-price',app.prices.mesghalMarket,10,'ØªÙˆÙ…Ø§Ù†','mesghalMarket','Ù…Ø«Ù‚Ø§Ù„','Ø±ÛŒØ§Ù„'],
        ['ğŸ’','Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø±','gold18-price',app.prices.geram18Market,10,'ØªÙˆÙ…Ø§Ù†/Ú¯Ø±Ù…','geram18Market','Ø·Ù„Ø§ÛŒ 18','Ø±ÛŒØ§Ù„'],
        ['ğŸª™','Ø³Ú©Ù‡ ØªÙ…Ø§Ù… Ø¨Ù‡Ø§Ø± Ø¢Ø²Ø§Ø¯ÛŒ','coin-price',app.prices.coinPrice,10,'ØªÙˆÙ…Ø§Ù†','coinPrice','Ø³Ú©Ù‡','Ø±ÛŒØ§Ù„'],
        ['ğŸ’µ','Ø¯Ù„Ø§Ø± Ø¢Ù…Ø±ÛŒÚ©Ø§','usd-price',app.prices.usdRate,10,'ØªÙˆÙ…Ø§Ù†','usdRate','Ø¯Ù„Ø§Ø±','Ø±ÛŒØ§Ù„'],
        ['ğŸ’','ØªØªØ± (USDT)','tether-price',app.prices.tether,10,'ØªÙˆÙ…Ø§Ù†','tether','ØªØªØ±','Ø±ÛŒØ§Ù„'],
        ['ğŸ›¢ï¸','Ù†ÙØª Ø¨Ø±Ù†Øª','brent-price',app.prices.brent,1,'Ø¯Ù„Ø§Ø±/Ø¨Ø´Ú©Ù‡','brent','Ù†ÙØª Ø¨Ø±Ù†Øª','Ø¯Ù„Ø§Ø±'],
        ['â‚¿','Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ†','btc-price',app.prices.btc,1,'Ø¯Ù„Ø§Ø±','btc','Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ†','Ø¯Ù„Ø§Ø±'],
        ['ğŸ‡¦ğŸ‡ª','Ø¯Ø±Ù‡Ù… Ø§Ù…Ø§Ø±Ø§Øª','dirham-price',app.prices.dirhamRate,10,'ØªÙˆÙ…Ø§Ù†','dirhamRate','Ø¯Ø±Ù‡Ù…','Ø±ÛŒØ§Ù„'],
        ['ğŸ‡¦ğŸ‡ª','Ø·Ù„Ø§ÛŒ 18 Ø§Ù…Ø§Ø±Ø§Øª','gold18uae-price',app.prices.gold18UAE,1,'Ø¯Ø±Ù‡Ù…/Ú¯Ø±Ù…','gold18UAE','Ø·Ù„Ø§ÛŒ 18 Ø§Ù…Ø§Ø±Ø§Øª','Ø¯Ø±Ù‡Ù…']
    ];

    let tableRows = rows.map(([icon,name,id,val,div,unit,key,title,editUnit]) => `
        <tr style="border-bottom:1px solid var(--border-color);transition:background 0.3s;" onmouseover="this.style.background='rgba(251,191,36,0.05)'" onmouseout="this.style.background='transparent'">
            <td style="padding:1.2rem;font-weight:500;"><span style="font-size:1.3rem;margin-left:0.5rem;">${icon}</span>${name}</td>
            <td style="padding:1.2rem;text-align:center;font-size:1.1rem;font-weight:bold;color:var(--accent-gold);" id="${id}">${formatNumber(val/div)}</td>
            <td style="padding:1.2rem;text-align:center;color:var(--text-secondary);">${unit}</td>
            ${app.isPro ? `<td style="padding:1.2rem;text-align:center;">${eb(key,title,val,editUnit)}</td>` : ''}
        </tr>`).join('');

    return `
        <div style="margin-bottom:2rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;">
            <button class="btn btn-primary" onclick="fetchLivePrices()"><span>ğŸ”„</span><span>Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§</span></button>
            <div style="color:var(--text-secondary);font-size:0.9rem;" id="lastUpdateTime">ğŸ“¡ Ù…Ù†Ø¨Ø¹: tgju.org</div>
        </div>
        <div class="card" style="padding:0;overflow:hidden;">
            <div style="padding:1.5rem;border-bottom:2px solid var(--border-color);background:linear-gradient(135deg,rgba(251,191,36,0.1),rgba(245,158,11,0.05));">
                <h3 style="margin:0;display:flex;align-items:center;gap:0.75rem;"><span style="font-size:1.5rem;">ğŸ’°</span><span>Ø¬Ø¯ÙˆÙ„ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø¨Ø§Ø²Ø§Ø±</span></h3>
            </div>
            <div style="overflow-x:auto;">
                <table style="width:100%;border-collapse:collapse;">
                    <thead><tr style="background:var(--bg-card);border-bottom:2px solid var(--border-color);">
                        <th style="padding:1.2rem;text-align:right;font-weight:600;color:var(--accent-gold);">Ø´Ø§Ø®Øµ</th>
                        <th style="padding:1.2rem;text-align:center;font-weight:600;color:var(--accent-gold);">Ù‚ÛŒÙ…Øª</th>
                        <th style="padding:1.2rem;text-align:center;font-weight:600;color:var(--accent-gold);">ÙˆØ§Ø­Ø¯</th>
                        ${app.isPro ? '<th style="padding:1.2rem;text-align:center;font-weight:600;color:var(--accent-gold);">Ø¹Ù…Ù„ÛŒØ§Øª</th>' : ''}
                    </tr></thead>
                    <tbody>${tableRows}</tbody>
                </table>
            </div>
        </div>

        <h3 style="margin:2rem 0 1rem;color:var(--accent-gold);">ğŸ“Š Ù†Ù…Ø§ÛŒ Ø³Ø±ÛŒØ¹ Ø¨Ø§ Ù†Ù…ÙˆØ¯Ø§Ø±</h3>
        <div class="cards-grid">
            ${[['ğŸŒ','Ø§Ù†Ø³ Ø·Ù„Ø§',app.prices.goldPrice,'Ø¯Ù„Ø§Ø±','goldChart'],['âšª','Ø§Ù†Ø³ Ù†Ù‚Ø±Ù‡',app.prices.silverPrice,'Ø¯Ù„Ø§Ø±','silverChart'],['ğŸ’µ','Ø¯Ù„Ø§Ø±',app.prices.usdRate/10,'ØªÙˆÙ…Ø§Ù†','usdChart'],['ğŸª™','Ø³Ú©Ù‡',app.prices.coinPrice/10,'ØªÙˆÙ…Ø§Ù†','coinChart'],['ğŸ’','Ø·Ù„Ø§ÛŒ 18',app.prices.geram18Market/10,'ØªÙˆÙ…Ø§Ù†/Ú¯Ø±Ù…','gold18Chart'],['âš–ï¸','Ù…Ø«Ù‚Ø§Ù„',app.prices.mesghalMarket/10,'ØªÙˆÙ…Ø§Ù†','mesghalChart'],['ğŸ’','ØªØªØ±',app.prices.tether/10,'ØªÙˆÙ…Ø§Ù†','tetherChart'],['ğŸ“Š','Ø¨ÙˆØ±Ø³',app.prices.bourse,'ÙˆØ§Ø­Ø¯','bourseChart'],['ğŸ›¢ï¸','Ù†ÙØª Ø¨Ø±Ù†Øª',app.prices.brent,'Ø¯Ù„Ø§Ø±','brentChart'],['â‚¿','Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ†',app.prices.btc,'Ø¯Ù„Ø§Ø±','btcChart']].map(([icon,name,val,unit,cid]) => `
            <div class="card">
                <div class="card-header"><div class="card-title"><span class="card-icon">${icon}</span><span>${name}</span></div></div>
                <div class="price-value">${formatNumber(val)}</div>
                <div class="price-label">${unit}</div>
                <div class="chart-container"><canvas id="${cid}"></canvas></div>
            </div>`).join('')}
        </div>`;
}

// ============================================================
// RENDER: ANALYSIS PAGE  (ÙÙ‚Ø· ÛŒÚ© Ù†Ø³Ø®Ù‡ â€” Ø´Ø¨ÛŒÙ‡ Ø¹Ú©Ø³ Ø´Ù…Ø§)
// ============================================================
function renderAnalysisPage() {
    const c = calculate();
    const p = app.prices;

    // Helper: signal box HTML
    function signalBox(signal, text) {
        const cls = { best_buy_iran:'signal-best-buy', good_buy_iran:'signal-good-buy', step_buy:'signal-caution', best_sell_iran:'signal-best-sell', normal:'signal-normal' };
        return `<div class="${cls[signal] || 'signal-normal'}" style="margin-top:1rem;">${text}</div>`;
    }

    return `
        <!-- ØªØ­Ù„ÛŒÙ„ Ù…Ø«Ù‚Ø§Ù„ -->
        <div class="analysis-card">
            <div class="analysis-header"><span class="analysis-icon">âš–ï¸</span><span class="analysis-title">ØªØ­Ù„ÛŒÙ„ Ù…Ø«Ù‚Ø§Ù„ Ø·Ù„Ø§</span></div>
            <div class="analysis-body">
                <div class="price-comparison">
                    <div class="price-box green-border"><div class="price-box-label">Ù‚ÛŒÙ…Øª Ø¨Ø§Ø²Ø§Ø±</div><div class="price-box-value">${formatNumber(p.mesghalMarket/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†</div></div>
                    <div class="price-box blue-border"><div class="price-box-label">Ù‚ÛŒÙ…Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡</div><div class="price-box-value">${formatNumber(c.mesghalTheo/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†</div></div>
                </div>
                <div class="difference-box">
                    <div class="difference-left">
                        <div class="difference-value-big ${c.diffMesghal >= 0 ? 'green' : 'red'}">${formatNumber(Math.abs(c.diffMesghal)/10)} ${c.diffMesghal >= 0 ? 'â†‘' : 'â†“'}</div>
                    </div>
                    <div class="difference-right">Ø§Ø®ØªÙ„Ø§Ù Ù‚ÛŒÙ…Øª ØªØ¦ÙˆØ±ÛŒ Ùˆ Ø¨Ø§Ø²Ø§Ø±<br>${c.diffMesghal > 0 ? 'ØªØ¦ÙˆØ±ÛŒ Ú¯Ø±Ø§Ù†â€ŒØªØ± Ø§Ø² Ø¨Ø§Ø²Ø§Ø±' : 'Ø¨Ø§Ø²Ø§Ø± Ú¯Ø±Ø§Ù†â€ŒØªØ± Ø§Ø² ØªØ¦ÙˆØ±ÛŒ'}</div>
                </div>
                ${c.diffMesghal > 10000000 ? '<div class="signal-best-buy">ğŸŸ¢ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ù…Ø«Ù‚Ø§Ù„</div>' :
                  c.diffMesghal > 5000000  ? '<div class="signal-good-buy">ğŸŸ¡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ù…ØªÙˆØ³Ø· Ù…Ø«Ù‚Ø§Ù„</div>' :
                  c.diffMesghal < -5000000 ? '<div class="signal-best-sell">ğŸ”´ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ù…Ø«Ù‚Ø§Ù„</div>' :
                  '<div class="signal-normal">â¡ï¸ ÙˆØ¶Ø¹ÛŒØª Ø¹Ø§Ø¯ÛŒ</div>'}
                <div class="interpretation"><div class="interpretation-title">ğŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø±ÙˆØ´:</div>
                    Ù‚ÛŒÙ…Øª ØªØ¦ÙˆØ±ÛŒ Ù…Ø«Ù‚Ø§Ù„ Ø§Ø² ÙØ±Ù…ÙˆÙ„ Ø§Ù†Ø³ Ø·Ù„Ø§ Ùˆ Ù†Ø±Ø® Ø¯Ù„Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.<br>
                    Ø§Ú¯Ø± Ø¨Ø§Ø²Ø§Ø± Ú©Ù…ØªØ± Ø¨Ø§Ø´Ø¯ â†’ ÙØ±ØµØª Ø®Ø±ÛŒØ¯ | Ø§Ú¯Ø± Ø¨Ø§Ø²Ø§Ø± Ø¨ÛŒØ´ØªØ± Ø¨Ø§Ø´Ø¯ â†’ ÙØ±ØµØª ÙØ±ÙˆØ´
                </div>
            </div>
        </div>

        <!-- ØªØ­Ù„ÛŒÙ„ Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø± -->
        <div class="analysis-card">
            <div class="analysis-header"><span class="analysis-icon">ğŸ’</span><span class="analysis-title">ØªØ­Ù„ÛŒÙ„ Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø± (3 Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…)</span></div>
            <div class="analysis-body">
                <div class="price-comparison">
                    <div class="price-box green-border"><div class="price-box-label">Ù‚ÛŒÙ…Øª Ø¨Ø§Ø²Ø§Ø±</div><div class="price-box-value">${formatNumber(p.geram18Market/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†/Ú¯Ø±Ù…</div></div>
                    <div class="price-box blue-border"><div class="price-box-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† 3 Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…</div><div class="price-box-value">${formatNumber(c.geram18Avg/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†/Ú¯Ø±Ù…</div></div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.6rem;margin:0.75rem 0;">
                    <div class="price-box" style="padding:0.7rem;"><div class="price-box-label" style="font-size:0.75rem;">Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Û±</div><div style="font-size:1rem;font-weight:bold;color:var(--accent-gold);">${formatNumber(c.geram18Theo1/10)}</div></div>
                    <div class="price-box" style="padding:0.7rem;"><div class="price-box-label" style="font-size:0.75rem;">Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Û²</div><div style="font-size:1rem;font-weight:bold;color:var(--accent-gold);">${formatNumber(c.geram18Theo2/10)}</div></div>
                    <div class="price-box" style="padding:0.7rem;"><div class="price-box-label" style="font-size:0.75rem;">Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Û³</div><div style="font-size:1rem;font-weight:bold;color:var(--accent-gold);">${formatNumber(c.geram18Theo3/10)}</div></div>
                </div>
                <div class="difference-box">
                    <div class="difference-left"><div class="difference-value-big ${c.diffGeram18 >= 0 ? 'green' : 'red'}">${formatNumber(Math.abs(c.diffGeram18)/10)} ${c.diffGeram18 >= 0 ? 'â†‘' : 'â†“'}</div></div>
                    <div class="difference-right">Ø§Ø®ØªÙ„Ø§Ù Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…â€ŒÙ‡Ø§ Ùˆ Ø¨Ø§Ø²Ø§Ø±</div>
                </div>
                ${c.diffGeram18 > 3000000 ? '<div class="signal-best-buy">ğŸŸ¢ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§ÛŒ 18</div>' :
                  c.diffGeram18 > 1000000 ? '<div class="signal-good-buy">ğŸŸ¡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ù…ØªÙˆØ³Ø·</div>' :
                  c.diffGeram18 < -3000000 ? '<div class="signal-best-sell">ğŸ”´ Ù…ÙˆÙ‚Ø¹ÛŒØª ÙØ±ÙˆØ´ Ø·Ù„Ø§ÛŒ 18</div>' :
                  '<div class="signal-normal">â¡ï¸ ÙˆØ¶Ø¹ÛŒØª Ø¹Ø§Ø¯ÛŒ</div>'}
                <div class="interpretation"><div class="interpretation-title">ğŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø±ÙˆØ´:</div>Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† 3 ÙØ±Ù…ÙˆÙ„ Ù…Ø®ØªÙ„Ù Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ù‚ÛŒÙ…Øª Ø¨Ø§Ø²Ø§Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
            </div>
        </div>

        <!-- ØªØ­Ù„ÛŒÙ„ Ø·Ù„Ø§ÛŒ 18 Ø§Ù…Ø§Ø±Ø§Øª (Ø´Ø¨ÛŒÙ‡ Ø¹Ú©Ø³ Ø´Ù…Ø§) -->
        <div class="analysis-card">
            <div class="analysis-header"><span class="analysis-icon">ğŸ‡¦ğŸ‡ª</span><span class="analysis-title">ØªØ­Ù„ÛŒÙ„ Ù‚ÛŒÙ…Øª Ø·Ù„Ø§ÛŒ 18 Ø¹ÛŒØ§Ø± Ø§Ù…Ø§Ø±Ø§Øª (Ø¯Ø±Ù‡Ù…)</span></div>
            <div class="analysis-body">
                <div class="price-comparison">
                    <div class="price-box green-border"><div class="price-box-label">Ù‚ÛŒÙ…Øª Ø¨Ø§Ø²Ø§Ø± Ø§ÛŒØ±Ø§Ù†</div><div class="price-box-value">${formatNumber(p.geram18Market/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†</div></div>
                    <div class="price-box blue-border"><div class="price-box-label">Ù‚ÛŒÙ…Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡</div><div class="price-box-value">${formatNumber(c.uaeGold18Calc/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†</div></div>
                </div>
                <div class="difference-box">
                    <div class="difference-left">
                        <div class="difference-value-big ${c.uaeGoldDiff >= 0 ? 'green' : 'red'}">${formatNumber(Math.abs(c.uaeGoldDiff)/10)} ${c.uaeGoldDiff >= 0 ? 'â†‘' : 'â†“'}</div>
                    </div>
                    <div class="difference-right">
                        Ø¯Ø±Ù‡Ù… Ø§Ù…Ø§Ø±Ø§Øª<br>
                        <strong>${formatNumber(p.dirhamRate/10)}</strong> ØªÙˆÙ…Ø§Ù† &nbsp; | &nbsp; Ø·Ù„Ø§ÛŒ 18 Ø§Ù…Ø§Ø±Ø§Øª: <strong>${formatNumber(p.gold18UAE)}</strong> Ø¯Ø±Ù‡Ù…<br>
                        Ø§Ø®ØªÙ„Ø§Ù: Ø·Ù„Ø§ÛŒ ${c.uaeGoldDiff > 0 ? 'Ø§Ù…Ø§Ø±Ø§Øª Ú¯Ø±Ø§Ù†â€ŒØªØ± Ø§Ø² Ø§ÛŒØ±Ø§Ù†' : 'Ø§ÛŒØ±Ø§Ù† Ú¯Ø±Ø§Ù†â€ŒØªØ± Ø§Ø² Ø§Ù…Ø§Ø±Ø§Øª'}
                    </div>
                </div>
                ${c.uaeGoldDiff > 9000000  ? '<div class="signal-best-buy">ğŸŸ¢ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ø§Ø² Ø§ÛŒØ±Ø§Ù†<br><span style="font-size:0.9rem;font-weight:normal;">Ù‚ÛŒÙ…Øª Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ø§Ù…Ø§Ø±Ø§Øª Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± Ø§Ø² Ø¨Ø§Ø²Ø§Ø± Ø§ÛŒØ±Ø§Ù† Ø§Ø³Øª â†’ ÙØ±ØµØª Ø®Ø±ÛŒØ¯ Ø®ÙˆØ¨</span></div>' :
                  c.uaeGoldDiff > 7000000  ? '<div class="signal-good-buy">ğŸŸ¢ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø®Ø±ÛŒØ¯ Ø§Ø² Ø§ÛŒØ±Ø§Ù†</div>' :
                  c.uaeGoldDiff > 3500000  ? '<div class="signal-caution">ğŸŸ¡ Ø®Ø±ÛŒØ¯ Ù¾Ù„Ù‡â€ŒØ§ÛŒ Ø§Ø² Ø§ÛŒØ±Ø§Ù†</div>' :
                  c.uaeGoldDiff < -9000000 ? '<div class="signal-best-sell">ğŸ”´ ÙØ±ÙˆØ´ Ø·Ù„Ø§ Ø¨Ù‡ Ø§Ù…Ø§Ø±Ø§Øª</div>' :
                  '<div class="signal-normal">â¡ï¸ ÙˆØ¶Ø¹ÛŒØª Ø¹Ø§Ø¯ÛŒ</div>'}
                <div class="interpretation"><div class="interpretation-title">ğŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø±ÙˆØ´:</div>
                    Ø§Ú¯Ø± Ù‚ÛŒÙ…Øª Ø§Ù…Ø§Ø±Ø§Øª Ù¾Ø§ÛŒÛŒÙ†â€ŒØªØ± Ø¨Ø§Ø´Ø¯ â†’ ÙØ±ØµØª ÙØ±ÙˆØ´ Ø§Ø² Ø§ÛŒØ±Ø§Ù†<br>
                    Ø§Ú¯Ø± Ø¨Ø§Ø²Ø§Ø± Ø§ÛŒØ±Ø§Ù† Ø¨Ø§Ù„Ø§ØªØ± Ø¨Ø§Ø´Ø¯ â†’ ÙØ±ØµØª Ø®Ø±ÛŒØ¯ Ø¯Ø§Ø±Ø¯<br>
                    Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø®ØªÙ„Ø§Ù Ø¨ÛŒØ´ Ø§Ø² Û·Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù† ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡ Ø§Ø³Øª.
                </div>
            </div>
        </div>

        <!-- Ù†Ø³Ø¨Øª Ø³Ú©Ù‡/Ø·Ù„Ø§ -->
        <div class="analysis-card">
            <div class="analysis-header"><span class="analysis-icon">ğŸª™</span><span class="analysis-title">Ù†Ø³Ø¨Øª Ø³Ú©Ù‡ Ø¨Ù‡ Ø·Ù„Ø§</span></div>
            <div class="analysis-body">
                <div class="price-comparison">
                    <div class="price-box green-border"><div class="price-box-label">Ù†Ø³Ø¨Øª ÙØ¹Ù„ÛŒ</div><div class="price-box-value">${c.coinRatio}</div><div class="price-box-unit">Ø³Ú©Ù‡ Ã· Ø·Ù„Ø§ÛŒ 18</div></div>
                    <div class="price-box blue-border"><div class="price-box-label">Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù†Ø±Ù…Ø§Ù„</div><div class="price-box-value">Û¹.Û· â€“ Û±Û±.Û³</div><div class="price-box-unit">Ù†Ø³Ø¨Øª</div></div>
                </div>
                ${c.coinSignal === 'buy_coin' ? '<div class="signal-best-buy">ğŸŸ¢ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡ - Ù†Ø³Ø¨Øª Ù¾Ø§ÛŒÛŒÙ†</div>' : c.coinSignal === 'buy_gold' ? '<div class="signal-best-sell">ğŸ”´ Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§ - Ø³Ú©Ù‡ Ú¯Ø±Ø§Ù†</div>' : '<div class="signal-normal">â¡ï¸ Ù†Ø³Ø¨Øª Ù…ØªØ¹Ø§Ø¯Ù„</div>'}
                <div class="interpretation"><div class="interpretation-title">ğŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø±ÙˆØ´:</div>Ù†Ø³Ø¨Øª Ø²ÛŒØ± Û¹.Û· â†’ Ø³Ú©Ù‡ Ø§Ø±Ø²Ø§Ù† â†’ Ø®Ø±ÛŒØ¯ Ø³Ú©Ù‡ | Ù†Ø³Ø¨Øª Ø¨Ø§Ù„Ø§ÛŒ Û±Û±.Û³ â†’ Ø³Ú©Ù‡ Ú¯Ø±Ø§Ù† â†’ Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§ÛŒ Ø®Ø§Ù…</div>
            </div>
        </div>

        <!-- Ù†Ø³Ø¨Øª Ø·Ù„Ø§/Ù†Ù‚Ø±Ù‡ -->
        <div class="analysis-card">
            <div class="analysis-header"><span class="analysis-icon">âšª</span><span class="analysis-title">Ù†Ø³Ø¨Øª Ø·Ù„Ø§ Ø¨Ù‡ Ù†Ù‚Ø±Ù‡ (G/S Ratio)</span></div>
            <div class="analysis-body">
                <div class="price-comparison">
                    <div class="price-box green-border"><div class="price-box-label">Ù†Ø³Ø¨Øª ÙØ¹Ù„ÛŒ</div><div class="price-box-value">${c.gsRatio}</div><div class="price-box-unit">Ø·Ù„Ø§ Ã· Ù†Ù‚Ø±Ù‡</div></div>
                    <div class="price-box blue-border"><div class="price-box-label">Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù†Ø±Ù…Ø§Ù„</div><div class="price-box-value">Û¶Û° â€“ Û¸Û°</div><div class="price-box-unit">Ù†Ø³Ø¨Øª</div></div>
                </div>
                ${parseFloat(c.gsRatio) < 60 ? '<div class="signal-best-buy">ğŸŸ¢ Ù†Ù‚Ø±Ù‡ Ù†Ø³Ø¨ØªØ§Ù‹ Ø§Ø±Ø²Ø§Ù†</div>' : parseFloat(c.gsRatio) > 80 ? '<div class="signal-caution">ğŸŸ¡ Ù†Ø³Ø¨Øª Ø¨Ø§Ù„Ø§ - Ù†Ù‚Ø±Ù‡ Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±</div>' : '<div class="signal-normal">â¡ï¸ Ù†Ø³Ø¨Øª Ù…ØªØ¹Ø§Ø¯Ù„</div>'}
                <div class="interpretation"><div class="interpretation-title">ğŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø±ÙˆØ´:</div>Ù†Ø³Ø¨Øª Ø²ÛŒØ± Û¶Û° â†’ Ù†Ù‚Ø±Ù‡ Ø§Ø±Ø²Ø§Ù† Ø§Ø³Øª | Ù†Ø³Ø¨Øª Ø¨Ø§Ù„Ø§ÛŒ Û¸Û° â†’ ÙØ±ØµØª Ø®Ø±ÛŒØ¯ Ù†Ù‚Ø±Ù‡ Ø¯Ø§Ø±Ø¯</div>
            </div>
        </div>

        <!-- ØªØ­Ù„ÛŒÙ„ Ø¯Ù„Ø§Ø± ÙˆØ§Ù‚Ø¹ÛŒ -->
        <div class="analysis-card">
            <div class="analysis-header"><span class="analysis-icon">ğŸ’µ</span><span class="analysis-title">Ù‚ÛŒÙ…Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ù„Ø§Ø± (Ø§Ø² Ø·Ù„Ø§)</span></div>
            <div class="analysis-body">
                <div class="price-comparison">
                    <div class="price-box green-border"><div class="price-box-label">Ø¯Ù„Ø§Ø± Ø¨Ø§Ø²Ø§Ø±</div><div class="price-box-value">${formatNumber(p.usdRate/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†</div></div>
                    <div class="price-box blue-border"><div class="price-box-label">Ø¯Ù„Ø§Ø± ÙˆØ§Ù‚Ø¹ÛŒ (Ø§Ø² Ø·Ù„Ø§)</div><div class="price-box-value">${formatNumber(c.realUsdPrice/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†</div></div>
                </div>
                <div class="difference-box">
                    <div class="difference-left"><div class="difference-value-big ${c.usdDiff >= 0 ? 'green' : 'red'}">${formatNumber(Math.abs(c.usdDiff)/10)} ${c.usdDiff >= 0 ? 'â†‘' : 'â†“'}</div></div>
                    <div class="difference-right">Ø§Ø®ØªÙ„Ø§Ù Ø¯Ù„Ø§Ø± ÙˆØ§Ù‚Ø¹ÛŒ Ùˆ Ø¨Ø§Ø²Ø§Ø±<br>${c.usdDiff > 0 ? 'Ø¯Ù„Ø§Ø± Ø¨Ø§Ø²Ø§Ø± Ú©Ù…ØªØ± Ø§Ø² ÙˆØ§Ù‚Ø¹ÛŒ (Ø­Ø¨Ø§Ø¨ Ù…Ù†ÙÛŒ)' : 'Ø¯Ù„Ø§Ø± Ø¨Ø§Ø²Ø§Ø± Ø¨ÛŒØ´ØªØ± Ø§Ø² ÙˆØ§Ù‚Ø¹ÛŒ'}</div>
                </div>
                ${c.usdSignal === 'negative_bubble' ? '<div class="signal-best-buy">ğŸŸ¢ Ø­Ø¨Ø§Ø¨ Ù…Ù†ÙÛŒ - ÙØ±ØµØª Ø®Ø±ÛŒØ¯ Ø·Ù„Ø§</div>' : c.usdSignal === 'positive_bubble' ? '<div class="signal-best-sell">ğŸ”´ Ø­Ø¨Ø§Ø¨ Ù…Ø«Ø¨Øª - Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯</div>' : '<div class="signal-normal">â¡ï¸ ÙˆØ¶Ø¹ÛŒØª Ø¹Ø§Ø¯ÛŒ</div>'}
                <div class="interpretation"><div class="interpretation-title">ğŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø±ÙˆØ´:</div>Ù‚ÛŒÙ…Øª ÙˆØ§Ù‚Ø¹ÛŒ Ø¯Ù„Ø§Ø± Ø§Ø² Ù†Ø±Ø® Ø·Ù„Ø§ÛŒ 18 Ùˆ Ø§Ù†Ø³ Ø·Ù„Ø§ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø¨Ø§ Ø¯Ù„Ø§Ø± Ø¨Ø§Ø²Ø§Ø± Ù…Ù‚Ø§ÛŒØ³Ù‡.</div>
            </div>
        </div>

        <!-- ØªØ­Ù„ÛŒÙ„ Ø¯Ø±Ù‡Ù… -->
        <div class="analysis-card">
            <div class="analysis-header"><span class="analysis-icon">ğŸ‡¦ğŸ‡ª</span><span class="analysis-title">ØªØ­Ù„ÛŒÙ„ Ø¯Ø±Ù‡Ù… Ø¨Ø±Ø§ÛŒ Ø¯Ù„Ø§Ø±</span></div>
            <div class="analysis-body">
                <div class="price-comparison">
                    <div class="price-box green-border"><div class="price-box-label">Ø¯Ù„Ø§Ø± Ø¨Ø§Ø²Ø§Ø±</div><div class="price-box-value">${formatNumber(p.usdRate/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†</div></div>
                    <div class="price-box blue-border"><div class="price-box-label">Ø¯Ù„Ø§Ø± Ø§Ø² Ø¯Ø±Ù‡Ù…</div><div class="price-box-value">${formatNumber(c.dirhamUsdCalc/10)}</div><div class="price-box-unit">ØªÙˆÙ…Ø§Ù†</div></div>
                </div>
                ${c.dirhamUsdSignal === 'expensive' ? '<div class="signal-best-sell">ğŸ”´ Ø¯Ù„Ø§Ø± Ú¯Ø±Ø§Ù† Ø§Ø³Øª Ø§Ø² Ø¯Ø±Ù‡Ù…</div>' : c.dirhamUsdSignal === 'cheap' ? '<div class="signal-best-buy">ğŸŸ¢ Ø¯Ù„Ø§Ø± Ø§Ø±Ø²Ø§Ù† Ø§Ø³Øª Ø§Ø² Ø¯Ø±Ù‡Ù…</div>' : '<div class="signal-normal">â¡ï¸ Ù‚ÛŒÙ…Øª Ù…ØªØ¹Ø§Ø¯Ù„</div>'}
                <div class="interpretation"><div class="interpretation-title">ğŸ’¡ ØªÙˆØ¶ÛŒØ­ Ø±ÙˆØ´:</div>Ù†Ø±Ø® Ø¯Ø±Ù‡Ù… Ã— Û³.Û¶Û· = Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ùˆ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ø¯Ù„Ø§Ø± Ø¨Ø§Ø²Ø§Ø±.</div>
            </div>
        </div>`;
}

// ============================================================
// âœ… RENDER: SIGNALS PAGE
// ============================================================
function renderSignalsPage() {
    if (app.signals.length === 0) calculateSignals();   // Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ø´Ø¯Ù‡

    const cardClass = s => {
        if (s.priority === 'high' && s.type === 'buy')  return 'high-buy';
        if (s.priority === 'high' && s.type === 'sell') return 'high-sell';
        if (s.priority === 'medium') return 'med';
        return 'low';
    };
    const priorityText = { high:'Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§Ù„Ø§', medium:'Ø§ÙˆÙ„ÙˆÛŒØª Ù…ØªÙˆØ³Ø·', low:'Ø§ÙˆÙ„ÙˆÛŒØª Ù¾Ø§ÛŒÛŒÙ†' };

    let signalsHTML = '';
    if (app.signals.length === 0) {
        signalsHTML = `<div class="signal-card" style="text-align:center;padding:2.5rem;">
            <div style="font-size:3rem;margin-bottom:1rem;">ğŸ“Š</div>
            <div style="color:var(--text-secondary);font-size:1.1rem;">Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ù†ÛŒØ³Øª<br><span style="font-size:0.9rem;">Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ² Ú©Ù†ÛŒØ¯ ØªØ§ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯</span></div>
            <button class="btn btn-primary" onclick="fetchLivePrices()" style="margin-top:1.5rem;"><span>ğŸ”„</span><span>Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§</span></button>
        </div>`;
    } else {
        signalsHTML = app.signals.map(s => `
            <div class="signal-card ${cardClass(s)}">
                <div class="signal-card-header">
                    <span class="signal-priority-badge ${s.priority}">${priorityText[s.priority]}</span>
                    ${s.priority === 'high' ? '<span style="font-size:0.8rem;color:var(--text-secondary);">â— Ú†Ø´Ù…Ú© Ø²Ø¯Ù† ÙØ¹Ø§Ù„</span>' : ''}
                </div>
                <div class="signal-card-title" style="color:${s.type==='buy'?'var(--accent-green)':s.type==='sell'?'var(--accent-red)':'var(--accent-gold)'};">${s.title}</div>
                <div class="signal-card-desc">${s.description}</div>
            </div>`).join('');
    }

    return `
        <div class="disclaimer">
            <div class="disclaimer-title">âš ï¸ Ø³Ù„Ø¨ Ù…Ø³Ø¦ÙˆÙ„ÛŒØª</div>
            Ø§ÛŒÙ† Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ ØµØ±ÙØ§Ù‹ Ø¬Ù†Ø¨Ù‡ Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø±Ù†Ø¯ Ùˆ <strong>ØªÙˆØµÛŒÙ‡ Ø¨Ù‡ Ø®Ø±ÛŒØ¯ ÛŒØ§ ÙØ±ÙˆØ´ Ù†ÛŒØ³ØªÙ†Ø¯</strong>.<br>
            ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ø´Ù…Ø§Ø³Øª. Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø± Ù‡Ø± Ù„Ø­Ø¸Ù‡ ØªØºÛŒÛŒØ± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;flex-wrap:wrap;gap:0.75rem;">
            <h3 style="color:var(--accent-gold);margin:0;">ğŸ¯ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ (${app.signals.length})</h3>
            <button class="btn btn-outline" onclick="fetchLivePrices()" style="font-size:0.85rem;padding:0.5rem 1rem;"><span>ğŸ”„</span><span>Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</span></button>
        </div>

        <!-- ÙÛŒÙ„ØªØ± Ø§ÙˆÙ„ÙˆÛŒØª -->
        <div style="display:flex;gap:0.6rem;margin-bottom:1.5rem;flex-wrap:wrap;">
            <span class="signal-priority-badge high" style="font-size:0.8rem;padding:0.3rem 0.7rem;cursor:pointer;">ğŸ”´ Ø¨Ø§Ù„Ø§ (${app.signals.filter(s=>s.priority==='high').length})</span>
            <span class="signal-priority-badge medium" style="font-size:0.8rem;padding:0.3rem 0.7rem;cursor:pointer;">ğŸŸ¡ Ù…ØªÙˆØ³Ø· (${app.signals.filter(s=>s.priority==='medium').length})</span>
            <span class="signal-priority-badge low" style="font-size:0.8rem;padding:0.3rem 0.7rem;cursor:pointer;">ğŸ”µ Ù¾Ø§ÛŒÛŒÙ† (${app.signals.filter(s=>s.priority==='low').length})</span>
        </div>

        ${signalsHTML}`;
}

// ============================================================
// RENDER: CALCULATOR
// ============================================================
function renderCalculatorPage() {
    return `
        <div class="cards-grid">
            <div class="card">
                <div class="card-header"><div class="card-title"><span class="card-icon">ğŸ›’</span><span>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ø±Ø²Ø´ Ø®Ø§Ù…</span></div></div>
                <label style="display:block;margin-bottom:0.5rem;font-weight:600;">ÙˆØ²Ù† (Ú¯Ø±Ù…):</label>
                <input type="number" id="rawWeight" value="10" step="0.1">
                <button class="btn btn-primary" onclick="calculateRaw()" style="width:100%;margin-top:1.5rem;padding:1rem;">ğŸ’° Ù…Ø­Ø§Ø³Ø¨Ù‡</button>
                <div id="rawResult"></div>
            </div>
            <div class="card">
                <div class="card-header"><div class="card-title"><span class="card-icon">ğŸ’</span><span>Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´</span></div></div>
                <label style="display:block;margin-bottom:0.5rem;font-weight:600;">ÙˆØ²Ù† (Ú¯Ø±Ù…):</label>
                <input type="number" id="sellWeight" value="18.7" step="0.1">
                <label style="display:block;margin-top:1rem;margin-bottom:0.5rem;font-weight:600;">Ø§Ø¬Ø±Øª (Ø±ÛŒØ§Ù„):</label>
                <input type="number" id="wage" value="1500000" step="10000">
                <label style="display:block;margin-top:1rem;margin-bottom:0.5rem;font-weight:600;">Ø³ÙˆØ¯ (%):</label>
                <input type="number" id="profit" value="7" step="0.1">
                <label style="display:block;margin-top:1rem;margin-bottom:0.5rem;font-weight:600;">Ù…Ø§Ù„ÛŒØ§Øª (%):</label>
                <input type="number" id="tax" value="9" step="0.1">
                <button class="btn btn-primary" onclick="calculateSell()" style="width:100%;margin-top:1.5rem;padding:1rem;">ğŸ’ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´</button>
                <div id="sellResult"></div>
            </div>
        </div>`;
}

// ============================================================
// RENDER: SETTINGS
// ============================================================
function renderSettingsPage() {
    return `
        <div class="cards-grid">
            <div class="card">
                <div class="card-header"><div class="card-title"><span class="card-icon">ğŸ‘¤</span><span>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø­Ø³Ø§Ø¨</span></div></div>
                <div class="info-box"><strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> ${app.user?.email || 'Ù…Ù‡Ù…Ø§Ù†'}<br><strong>ÙˆØ¶Ø¹ÛŒØª:</strong> â­ Ù¾Ø±Ùˆ ÙØ¹Ø§Ù„ (Ø§ÙØªØªØ§Ø­ÛŒÙ‡)<br><strong>Ø§Ø¹ØªØ¨Ø§Ø±:</strong> Ø±Ø§ÛŒÚ¯Ø§Ù†</div>
            </div>
            <div class="card">
                <div class="card-header"><div class="card-title"><span class="card-icon">â­</span><span>Ù…Ø²Ø§ÛŒØ§ÛŒ Ù¾Ø±Ùˆ</span></div></div>
                <div class="info-box"><strong>Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„:</strong><br>âœ… ÙˆÛŒØ±Ø§ÛŒØ´ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§<br>âœ… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù‡Ù…Ù‡ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§<br>âœ… Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯<br>âœ… Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ</div>
                <div class="success" style="margin-top:1rem;">âœ… Ø§Ø´ØªØ±Ø§Ú© Ù¾Ø±Ùˆ ÙØ¹Ø§Ù„ Ø§Ø³Øª (Ø§ÙØªØªØ§Ø­ÛŒÙ‡)</div>
            </div>
        </div>`;
}

// ============================================================
// CALCULATOR FUNCTIONS
// ============================================================
function calculateRaw() {
    const w = parseFloat(document.getElementById('rawWeight').value);
    if (!w || w <= 0) { showNotification('ÙˆØ²Ù† Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error'); return; }
    const price = w * app.prices.geram18Market * (740/750);
    document.getElementById('rawResult').innerHTML = `<div class="market-value" style="margin-top:1.5rem;text-align:center;"><div style="font-size:2rem;font-weight:bold;color:var(--accent-gold);">${formatNumber(price)}</div><div style="color:var(--text-secondary);margin-top:0.5rem;">Ø±ÛŒØ§Ù„</div></div>`;
}
function calculateSell() {
    const w = parseFloat(document.getElementById('sellWeight').value);
    const wage = parseFloat(document.getElementById('wage').value);
    const prof = parseFloat(document.getElementById('profit').value);
    const tax = parseFloat(document.getElementById('tax').value);
    if (!w || w <= 0) { showNotification('ÙˆØ²Ù† Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'error'); return; }
    const gold = w * app.prices.geram18Market;
    const profVal = (gold + wage) * (prof / 100);
    const taxVal = (wage + profVal) * (tax / 100);
    const total = gold + wage + profVal + taxVal;
    document.getElementById('sellResult').innerHTML = `<div class="market-value" style="margin-top:1.5rem;text-align:center;"><div style="font-size:2rem;font-weight:bold;color:var(--accent-gold);">${formatNumber(total)}</div><div style="color:var(--text-secondary);margin-top:0.5rem;">Ø±ÛŒØ§Ù„</div><div style="margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border-color);font-size:0.9rem;line-height:1.8;text-align:right;">Ø·Ù„Ø§ÛŒ Ø®Ø§Ù…: ${formatNumber(gold)}<br>Ø§Ø¬Ø±Øª: ${formatNumber(wage)}<br>Ø³ÙˆØ¯: ${formatNumber(profVal)}<br>Ù…Ø§Ù„ÛŒØ§Øª: ${formatNumber(taxVal)}</div></div>`;
}

// ============================================================
// CHARTS
// ============================================================
function renderCharts() {
    const charts = [
        {id: 'goldChart',    key: 'goldPrice',     label: 'Ø§Ù†Ø³ Ø·Ù„Ø§', color: '#fbbf24'},
        {id: 'silverChart',  key: 'silverPrice',   label: 'Ø§Ù†Ø³ Ù†Ù‚Ø±Ù‡', color: '#a0aec0'},
        {id: 'usdChart',     key: 'usdRate',       label: 'Ø¯Ù„Ø§Ø±', color: '#3b82f6', divider: 10},
        {id: 'coinChart',    key: 'coinPrice',     label: 'Ø³Ú©Ù‡', color: '#f59e0b', divider: 10},
        {id: 'gold18Chart',  key: 'geram18Market', label: 'Ø·Ù„Ø§ÛŒ 18', color: '#d97706', divider: 10},
        {id: 'mesghalChart', key: 'mesghalMarket', label: 'Ù…Ø«Ù‚Ø§Ù„', color: '#b45309', divider: 10},
        // Ø¨Ù‚ÛŒÙ‡ Ø±Ø§ Ù‡Ù… Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯ Ø§Ú¯Ø± history Ø¯Ø§Ø±ÛŒØ¯
    ];

    charts.forEach(chart => {
        const canvas = document.getElementById(chart.id);
        if (!canvas) return;
        if (canvas.__chartInstance) canvas.__chartInstance.destroy();

        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² history (Ø­Ø¯Ø§Ú©Ø«Ø± ÛµÛ° ØªØ§ÛŒ Ø¢Ø®Ø±)
        const dataPoints = app.priceHistory.map(h => ({
            x: new Date(h.timestamp).toLocaleTimeString('fa-IR', {hour:'2-digit', minute:'2-digit'}),
            y: (h[chart.key] || 0) / (chart.divider || 1)
        })).slice(-20);  // ÙÙ‚Ø· Û²Û° ØªØ§ÛŒ Ø¢Ø®Ø± Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ

        if (dataPoints.length < 2) {
            // Ø§Ú¯Ø± history Ú©Ù… Ø¨ÙˆØ¯ØŒ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ù†Ù‚Ø·Ù‡ ÙÛŒÚ© Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯
            dataPoints.push({x: 'Ø§Ù„Ø§Ù†', y: (app.prices[chart.key] || 0) / (chart.divider || 1)});
        }

        canvas.__chartInstance = new Chart(canvas.getContext('2d'), {
            type: 'line',
            data: {
                labels: dataPoints.map(d => d.x),
                datasets: [{
                    label: chart.label,
                    data: dataPoints.map(d => d.y),
                    borderColor: chart.color,
                    backgroundColor: chart.color + '33',  // Ø´ÙØ§Ù
                    tension: 0.4,
                    fill: true,
                    pointRadius: 3,
                    pointBackgroundColor: chart.color
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: true, position: 'top' } },
                scales: {
                    x: { title: { display: true, text: 'Ø²Ù…Ø§Ù†' } },
                    y: { title: { display: true, text: 'Ù…Ù‚Ø¯Ø§Ø±' } }
                }
            }
        });
    });
}

// ============================================================
// INIT
// ============================================================
function init() {
    document.documentElement.setAttribute('data-theme', app.theme);
    const user = DB.getCurrentUser();
    if (user) {
        app.user = user;
        app.isPro = true;
        const saved = DB.getPrices();
        if (saved) app.prices = saved;
        initDashboard();
        setInterval(() => { if (app.currentPage === 'prices' && document.visibilityState === 'visible') fetchLivePrices(); }, 10000);
    } else {
        document.getElementById('welcomeScreen').style.display = 'flex';
        document.getElementById('mainContent').style.display = 'none';
    }
}
init();
</script>

    <div class="disclaimer" style="margin: 1.5rem 0; padding: 1.5rem; background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.05)); border: 3px solid var(--accent-red); border-radius: 1rem; font-size: 1rem; line-height: 1.8;">
        <div class="disclaimer-title" style="font-size: 1.2rem; margin-bottom: 0.8rem;">âš ï¸ Ù‡Ø´Ø¯Ø§Ø± Ù…Ù‡Ù… â€“ Ø³Ù„Ø¨ Ù…Ø³Ø¦ÙˆÙ„ÛŒØª Ú©Ø§Ù…Ù„</div>
        <ul style="padding-right: 1.5rem; list-style-type: disc;">
            <li>Ø§ÛŒÙ† ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ Ùˆ Ø³ÛŒÚ¯Ù†Ø§Ù„â€ŒÙ‡Ø§ ØµØ±ÙØ§Ù‹ Ø¬Ù†Ø¨Ù‡ Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ùˆ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¯Ø§Ø±Ù†Ø¯ Ùˆ <strong>Ø¨Ù‡ Ù‡ÛŒÚ† Ø¹Ù†ÙˆØ§Ù† ØªÙˆØµÛŒÙ‡ Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒØŒ Ø®Ø±ÛŒØ¯ ÛŒØ§ ÙØ±ÙˆØ´ Ù†ÛŒØ³ØªÙ†Ø¯</strong>.</li>
            <li>Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§ Ùˆ Ø§Ø±Ø² Ø¨Ø³ÛŒØ§Ø± Ù¾Ø±Ù†ÙˆØ³Ø§Ù† Ø§Ø³Øª Ùˆ ØªØ­Øª ØªØ£Ø«ÛŒØ± Ø¹ÙˆØ§Ù…Ù„ Ø³ÛŒØ§Ø³ÛŒØŒ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ùˆ Ø¬Ù‡Ø§Ù†ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯. ØªØµÙ…ÛŒÙ…â€ŒÚ¯ÛŒØ±ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø¨Ø± Ø¹Ù‡Ø¯Ù‡ Ø®ÙˆØ¯ Ø´Ù…Ø§Ø³Øª.</li>
            <li>Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø§ ØªØ£Ø®ÛŒØ± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´ÙˆÙ†Ø¯ Ùˆ Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø§ Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¹ØªØ¨Ø± (Ù…Ø§Ù†Ù†Ø¯ tgju.org) ØªØ·Ø¨ÛŒÙ‚ Ø¯Ù‡ÛŒØ¯.</li>
            <li>Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡/Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÛŒÚ† Ù…Ø³Ø¦ÙˆÙ„ÛŒØªÛŒ Ø¯Ø± Ù‚Ø¨Ø§Ù„ Ø³ÙˆØ¯ ÛŒØ§ Ø²ÛŒØ§Ù† Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ù†Ø§Ø´ÛŒ Ø§Ø² Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø¯Ø§Ø±Ø¯.</li>
        </ul>
    </div>`;    
</body>
    </html>